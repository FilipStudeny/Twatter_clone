import Head from 'next/head'
import Image from 'next/image'
import { useState } from 'react';
import Post from '../components/Post';
import styles from '../styles/HomePage.module.css'

const Home = () => {

    const [newPostBody, setNewPostBody] = useState<any>();
    
    const changeFormHeight = () => {

        let textArea = (document.getElementById("NewPostForm") as HTMLTextAreaElement);
        const numOfRows = textArea.value.split('\n').length;        

        if(textArea.value == ""){
            textArea.style.height = "80px";
        }

        switch (true) {
            case (numOfRows >= 7):
                textArea.style.height = "200px";
                break;
            case (numOfRows >= 3):
                textArea.style.height = "150px";
                break;
            default:
                textArea.style.height = "80px";
                break;
        }

        setNewPostBody(textArea.value)
          
    }


    const onSubmit = async (event: React.FormEvent<HTMLFormElement>): Promise<void> => {
        event.preventDefault();

        const payload = { 
            'token': localStorage.getItem('token'),
            'post_content': encodeURIComponent(newPostBody)
        }
        
        const body = JSON.stringify(payload);
        let response: any;

        try {
            // Make API call to post data
          } catch (error) {
            // Handle error appropriately
            console.error(error);
          }

    }

    return (
        <>
            <Head>
                <title>Kiwi | Home page</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <div className={styles.NewPostContainer}>
                <Image src='/images/user_icon.png' width="512" height="512" alt='User profile image'/>
                <form className={styles.Form} onSubmit={onSubmit}>
                    <textarea id='NewPostForm' onChange={changeFormHeight}/>
                    <div className={styles.FormToolBar}>
                        <div>
                            <button>Image</button>
                        </div>

                        <button>Post</button>
                    </div>
                </form>
            </div>

            <div>
                  
                <Post/>

                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                <Post/>
                    
                    
            </div>
        </>
    )
}

export default Home